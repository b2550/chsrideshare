{% extends 'layout.html' %}
{% block body %}
    <h1>Dashboard</h1>
    {% if address_form %}
        {% include 'addressform.html' %}
    {% endif %}

    {% if groups %}
        <h2>Your groups</h2>
        <ul>
            {% for group in groups %}
                <li><a href="{{ url_for('group_page', join_id=group.join_id) }}">{{ group.name }}</a></li>
            {% endfor %}
        </ul>
    {% endif %}

    <h2>Carpool Candidates</h2>
    {% if range_form %}
        <form method="post" action="{{ url_for('dashboard') }}">
            {{ range_form.csrf_token }}
            {{ range_form.range.label }} {{ range_form.range(value=query_range) }}
            <input type="submit" value="Set Range">
        </form>
    {% endif %}

    {% if sent %}
        {% for req in sent[0].sentrequests %}
            <p>{{ req.receiver.firstname }} {{ req.receiver.lastname }} <input type='button' value='Awaiting Response'
                                                                               disabled></p>
        {% endfor %}
    {% endif %}

    {% if canidates %}
        {% for canidate in canidates if canidate.email != g.user.email %}
            <form method="post" action="{{ url_for('dashboard') }}">
                {{ request_form.csrf_token }}
                <p>{{ canidate.firstname }} {{ canidate.lastname }}</p>
                {{ request_form.message.label }} {{ request_form.message }}
                {{ request_form.group_id.label }} {{ request_form.group_id }}
                {{ request_form.user_destination(value=canidate.id) }}
                <input type="submit" value="Request Information">
            </form>
            <p>---</p>
        {% endfor %}
    {% endif %}

    {% if requests %}
        <h2>Carpool Requests</h2>
        {% for req in requests[0].requests %}
            <p>{{ req.sender.firstname }} {{ req.sender.lastname }}</p>
            {% if req.message %}
                <p>{{ req.message }}</p>
            {% endif %}
            <form method="post" action="{{ url_for('dashboard') }}">
                {{ accept_form.csrf_token }}
                {{ accept_form.user_origin(value=req.sender.id) }}
                {{ accept_form.group_id(value=req.group_id) }}
                <input type="submit" value="Exchange Information">
            </form>
        {% endfor %}
    {% endif %}

{% endblock %}